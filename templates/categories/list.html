{% extends "base.html" %}

{% block title %}รายการหมวดหมู่สินค้า - GoFresh StockPro{% endblock %}

{% block content %}

{# ---- ส่วนแสดง Message ---- #}
{% set message = request.query_params.get('message') %}
{% if message %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{% set error = request.query_params.get('error') %}
{% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        ข้อผิดพลาด: {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{# ------------------------ #}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>รายการหมวดหมู่สินค้า</h1>
    <a href="/ui/categories/add" class="btn btn-primary">เพิ่มหมวดหมู่ใหม่</a>
</div>

{# --- แสดงจำนวนข้อมูล + หน้าปัจจุบัน --- #}
{% if total_count > 0 %}
<p>พบข้อมูลทั้งหมด {{ total_count }} รายการ (หน้าที่ {{ page }} / {{ total_pages }})</p>
{% endif %}


{% if categories %}
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>รหัส (ID)</th>
            <th>ชื่อหมวดหมู่</th>
            <th>การดำเนินการ</th>
        </tr>
    </thead>
    <tbody>
        {% for category in categories %} {# <-- วนลูป categories (มาจาก items) #}
        <tr>
            <td>{{ category.id }}</td>
            <td>{{ category.name }}</td>
            <td>
                <a href="/ui/categories/edit/{{ category.id }}" class="btn btn-sm btn-warning">แก้ไข</a>
                <form method="post" action="/ui/categories/delete/{{ category.id }}" style="display: inline;"
                      onsubmit="return confirm('คุณแน่ใจหรือไม่ว่าต้องการลบหมวดหมู่ \'{{ category.name }}\'? การลบจะทำไม่ได้หากมีสินค้าอยู่ในหมวดหมู่นี้');">
                    <button type="submit" class="btn btn-sm btn-danger">ลบ</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">ไม่พบข้อมูลหมวดหมู่</p>
{% endif %}

{# --- เพิ่ม: Include Pagination Template --- #}
<div class="mt-4 d-flex justify-content-center">
    {% include '_pagination.html' %} {# include partial เข้ามา #}
</div>
{# ------------------------------------ #}

{% endblock %}