{% extends "base.html" %}

{% block title %}รายการสถานที่จัดเก็บ - GoFresh StockPro{% endblock %}

{% block content %}

{# ---- ส่วนแสดง Message ---- #}
{% set message = request.query_params.get('message') %}
{% if message %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{% set error = request.query_params.get('error') %}
{% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        ข้อผิดพลาด: {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{# ------------------------ #}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>รายการสถานที่จัดเก็บ</h1>
    <a href="/ui/locations/add" class="btn btn-primary">เพิ่มสถานที่ใหม่</a>
</div>

{# --- แสดงจำนวนข้อมูล + หน้าปัจจุบัน --- #}
{% if total_count > 0 %}
<p>พบข้อมูลทั้งหมด {{ total_count }} รายการ (หน้าที่ {{ page }} / {{ total_pages }})</p>
{% endif %}


{% if locations %}
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>รหัส</th>
            <th>ชื่อสถานที่</th>
            <th>รายละเอียด</th>
            <th>การดำเนินการ</th>
        </tr>
    </thead>
    <tbody>
        {% for location in locations %} {# <-- ใช้ locations ที่ส่งมา #}
        <tr>
            <td>{{ location.id }}</td>
            <td>{{ location.name }}</td>
            <td>{{ location.description if location.description else '-' }}</td>
            <td>
                <a href="/ui/locations/edit/{{ location.id }}" class="btn btn-sm btn-warning">แก้ไข</a>
                <form method="post" action="/ui/locations/delete/{{ location.id }}" style="display: inline;"
                      onsubmit="return confirm('คุณแน่ใจหรือไม่ว่าต้องการลบสถานที่ \'{{ location.name }}\'? การลบจะทำไม่ได้หากสถานที่นี้เคยถูกใช้งานแล้ว');">
                    <button type="submit" class="btn btn-sm btn-danger">ลบ</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">ไม่พบข้อมูลสถานที่จัดเก็บ</p>
{% endif %}

{# --- Include Pagination Template --- #}
<div class="mt-4 d-flex justify-content-center">
    {% include '_pagination.html' %}
</div>
{# ------------------------------- #}

{% endblock %}