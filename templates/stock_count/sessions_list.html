{% extends "base.html" %}

{% block title %}รอบนับสต็อก - GoFresh StockPro{% endblock %}

{% block content %}

{# ---- ส่วนแสดง Message ---- #}
{% set message = request.query_params.get('message') %}
{% if message %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{% set error = request.query_params.get('error') %}
{% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        ข้อผิดพลาด: {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{# ------------------------ #}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>รอบนับสต็อก</h1>
    <a href="/ui/stock-counts/sessions/new" class="btn btn-primary">สร้างรอบนับใหม่</a>
</div>

{% if total_count > 0 %}
<p>พบข้อมูลทั้งหมด {{ total_count }} รายการ (หน้าที่ {{ page }} / {{ total_pages }})</p>
{% endif %}

{% if sessions %}
<table class="table table-striped table-hover table-sm">
    <thead>
        <tr>
            <th>รหัสรอบนับ (ID)</th>
            <th>สถานที่จัดเก็บ</th>
            <th>วันที่เริ่ม</th>
            <th>วันที่สิ้นสุด</th>
            <th>สถานะ</th>
            <th>หมายเหตุ</th>
            <th>การดำเนินการ</th>
        </tr>
    </thead>
    <tbody>
        {% for session in sessions %}
        <tr>
            <td>{{ session.id }}</td>
            <td>{{ session.location.name if session.location else 'N/A' }}</td>
            <td>{{ session.start_date.strftime('%Y-%m-%d %H:%M') if session.start_date else '-'}}</td>
            <td>{{ session.end_date.strftime('%Y-%m-%d %H:%M') if session.end_date else '-'}}</td>
            <td>
                <span class="badge
                    {% if session.status.value == 'OPEN' %} bg-secondary
                    {% elif session.status.value == 'COUNTING' %} bg-info text-dark
                    {% elif session.status.value == 'CLOSED' %} bg-success
                    {% elif session.status.value == 'CANCELED' %} bg-danger
                    {% else %} bg-light text-dark {% endif %}">
                    {{ session.status.value }}
                </span>
            </td>
            <td>{{ session.notes if session.notes else '-' }}</td>
            <td>
                <a href="/ui/stock-counts/sessions/{{ session.id }}" class="btn btn-sm btn-info">ดู/ดำเนินการ</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">ยังไม่มีรอบนับสต็อก</p>
{% endif %}

{# --- Include Pagination Template --- #}
<div class="mt-4 d-flex justify-content-center">
    {% include '_pagination.html' %}
</div>

{% endblock %}