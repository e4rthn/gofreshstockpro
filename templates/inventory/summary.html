{% extends "base.html" %}

{% block title %}สรุปสต็อกคงคลัง - GoFresh StockPro{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>สรุปสต็อกคงคลัง</h1>
    <div>
        <a href="/ui/inventory/adjust/" class="btn btn-warning">ปรับปรุงสต็อก</a> {# เปลี่ยนลิงก์ไปหน้า Adjustment #}
        <a href="/ui/inventory/stock-in/" class="btn btn-success">รับสินค้าเข้า</a>
    </div>
</div>

{# ---- ส่วนแสดง Message ---- #}
{% set message = request.query_params.get('message') %}
{% if message %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{% set error = request.query_params.get('error') %}
{% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        ข้อผิดพลาด: {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}
{# ------------------------ #}


{% if stock_summary %}
<table class="table table-striped table-hover table-sm">
    <thead>
        <tr>
            <th>สถานที่จัดเก็บ</th>
            <th>ชื่อสินค้า</th>
            <th>SKU/รหัสสินค้า</th>
            <th>หมวดหมู่</th>
            <th class="text-end">จำนวนคงเหลือ</th>
            <th>อัปเดตล่าสุด</th>
        </tr>
    </thead>
    <tbody>
        {% for item in stock_summary %}
        <tr>
            <td>{{ item.location.name }}</td>
            <td>{{ item.product.name }}</td>
            <td>{{ item.product.sku }}</td>
            <td>{{ item.product.category.name }}</td>
            <td class="text-end">{{ item.quantity }}</td>
            <td>{{ item.last_updated.strftime('%Y-%m-%d %H:%M:%S') if item.last_updated else '-'}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">ไม่พบข้อมูลสต็อกปัจจุบัน</p>
<p>ลอง <a href="/ui/inventory/stock-in/">รับสินค้าเข้า</a> ก่อน</p>
{% endif %}

{% endblock %}